# Getting_cleaning_data

This repo contains the R code run_analysis.R (described below), a tidy dataset generated by run_analysis, and a code book describing the data.

The script is designed to pull specific data from zipped folder of data relating to movement parameters recorded using a Samsung Smartphone. The data and labels for the data were spread across several files in the zipped folder, including row and column labels as well as separate test and training sets of data. The output of this script is two datasets. Details about the experiment and the datasets produced by the code can be found in the CodeBook.md file in this repo.

While, in hindsight, this code could have been shortened by flipping around the order of binding the files together and selecting columns, this script does do the job. It compiles and analyzes data from a zipped dataset at https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip. The script should be run using the UCI HAR Dataset file from the zipped file as the working directory. 

Functional chunks of the code are described below.
```{r}
features <- fread("./features.txt")
x_test <- fread("./test/X_test.txt")
y_test <- fread("./test/y_test.txt")
x_train <- fread("./train/X_train.txt")
y_train <- fread("./train/y_train.txt")
test_subject <- fread("./test/subject_test.txt")
train_subject <- fread("./train/subject_train.txt")
```
The code above reads the relevant files from the unzipped datafile linked above and generates datasets for each file. It is important that the working directory is set to the UCI HAR Dataset before running this script. These files are in the main folder or subfolders of this folder.


```{r}
feature_title <- features$V2
feature_names <- feature_title[grep("mean|std", feature_title)]
feature_names <- gsub("\\()", "", feature_names)
```
The goal of these lines of code were to pull out the column names for the x_test and y_test files from the features.txt file. Only those column names containing "mean" or "std" were pulled from this file. In addition "()" in those names was removed for clarity.

```{r}
x_test_sub <- select(x_test, all_of(grep("mean|std", feature_title)))
x_train_sub <- select(x_train, all_of(grep("mean|std", feature_title)))
colnames(x_test_sub) <- feature_names
colnames(x_train_sub) <- feature_names
```
This code makes subfiles of the x_test and x_train data that corresponds to the columns containing "mean" or "std" in the column title. The column names were then appended to these files.

```{r}
test_master <- cbind(y_test, test_subject, x_test_sub)
experiment <- "test"
test_master <- cbind(experiment, test_master)
train_master <- cbind(y_train, train_subject, x_train_sub)
experiment <- "train"
train_master <- cbind(experiment, train_master)
```
These lines of code build two master files, one for the training set and another for the testing set. This appends the activity data from the "y_" files and the subject identifiers from the "_subject" files, to the data files for each set of data. In addition, an additional column was added to each file to indicate whether the data was from the training or test set. This column remains in the master file that will be created by this code, but is not in the tidy data set. As a scientist myself, I would want to retain this information in my main dataset, and thus I included it here.

```{r}
master <- rbind(test_master, train_master)
#row binds the training and test datasets
master <- rename(master, "activity" = c(2), "subject" = c(3))
#adds column names to the activity and subject columns
master <- select(master, -grep("meanFreq", names(master)))
#removes the "meanFreq" data from the master dataset
master$activity <- as.character(master$activity)
master$activity <- recode(master$activity, "1" = "walking", "2" = "walkingup", 
                 "3" = "walkingdown", "4" = "sitting", "5" = "standing", 
                 "6" = "laying")
```
This code adds the training data below the test data, adds column names for the activity and subject columns, and recodes the activity column so that the labels are descriptive of the activity performed. Several columns that did not contain "mean" data("meanFreq" columns) were also removed from the dataset at this time. The output of this code will be a master dataset (master) containing all the data mentioned above, including the replicates for each subject.

```{r}
rm(features, test_master, test_subject, train_master, train_subject, x_test,
   x_test_sub, x_train, x_train_sub, y_test, y_train)
```
The goal of this code is to remove the intermediate datasets generated in the code. It is not necessary for the function of the code, but cleans up the output to remove possible confusion.

```{r}
tidym <-master %>%
          select(-experiment) %>%
          group_by(activity, subject) %>%
          summarise_all("mean")
```
This generates the tidy dataset (tidym) for the data. It averages each data reading in the master file by activity and subject. The training vs. test information from the master dataset was removed from this dataset.
